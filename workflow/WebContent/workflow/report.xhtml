<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template.xhtml">
	<ui:define name="body">
		<ui:repeat var="process" value="#{report.workflow.processDefinitions}">
			<rich:simpleTogglePanel switchType="client" label="#{process.name}" opened="false">	
				<h:outputText value="Não Iniciado..." rendered="#{process.startedAt == null}"/>
				
				<ui:repeat var="taskNode" value="#{process.taskNodes}">
					<rich:simpleTogglePanel switchType="client" label="#{taskNode.name}" opened="true"
											rendered="#{taskNode.startState eq null}" >	
						<ui:repeat value="#{taskNode.userExecutions}" var="userExecution" >
							<rich:panel header="#{userExecution.user.name}" style="width: 300px; height: 150px; float: left;" >
								<h:panelGrid columns="2">
									<h:outputLabel value="Tempo gasto" />
									<h:outputText rendered="#{userExecution.wastedTime != null}"  value="#{userExecution.wastedTime} Segundos" ></h:outputText>
									<h:outputText rendered="#{userExecution.wastedTime == null}" value="Em andamento..." ></h:outputText>
								
									<h:outputLabel value="Inicio" />
									<h:outputText value="#{userExecution.startedAt.time}" >
										<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
									</h:outputText>
									
									<h:outputLabel value="Fim" />
									<h:outputText value="#{userExecution.finishedAt.time}" >
										<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
									</h:outputText>
									
									<h:outputLabel value="Tempo de pausa" />
									<h:outputText value="Ainda nao implementado" />
									
									<rich:spacer></rich:spacer>
									 <h:outputLink value="#" id="artefacts">
									        Artefatos de Saída 
									        <rich:componentControl for="artefactsModal" attachTo="artefacts" operation="show" event="onclick"/>
									 </h:outputLink>
									 <rich:modalPanel id="artefactsModal" width="650" >
								        <f:facet name="header">
								            <h:panelGroup>
								                <h:outputText value="Artefatos de Saída"></h:outputText>
								            </h:panelGroup>
								        </f:facet>
								        <f:facet name="controls">
								            <h:panelGroup>
								                <h:graphicImage value="/img/close.png" styleClass="hidelink" id="hidelinkArtefacts"/>
								                <rich:componentControl for="artefactsModal" attachTo="hidelinkArtefacts" operation="hide" event="onclick"/>
								            </h:panelGroup>
								        </f:facet>
								          <h:panelGrid columns="2">
								           <h:outputLabel value="Artefatos da Atividade: #{taskNode.name}" rendered="#{taskNode.outArtefacts.size() gt 0}" />
									       <rich:dataTable style="width: 700px;" rendered="#{taskNode.outArtefacts.size() gt 0}" value="#{taskNode.outArtefacts}" var="artefact" id="taskNodeArtefacts">
													<h:column>
														<f:facet name="header">Nome</f:facet>
														<h:outputText value="#{artefact.name}" />
													</h:column>
													<h:column>
														<h:commandLink value="Download" action="#{sendFile.sendFile(artefact.get(userExecution))}"
														 rendered="#{artefact.get(userExecution) != null}"
										 				 status="block"
										 				 target="_blank">
							 				 			</h:commandLink>
							 				 		</h:column>
									       </rich:dataTable>
								          </h:panelGrid>
									       <ui:repeat var="task" value="#{taskNode.tasks}">
  										     <h:panelGrid columns="2">
										       <h:outputLabel value="Artefatos da Tarefa: #{task.name}" rendered="#{task.outArtefacts.size() gt 0}" />
										       <rich:dataTable style="width: 500px;" rendered="#{task.outArtefacts.size() gt 0}" value="#{task.outArtefacts}" var="artefact" id="taskArtefacts">
														<h:column>
															<f:facet name="header">Nome</f:facet>
															<h:outputText value="#{artefact.name}" />
														</h:column>
														<h:column>
															<h:commandLink value="Download" action="#{sendFile.sendFile(artefact.get(userExecution))}"
															 rendered="#{artefact.get(userExecution) != null}"
											 				 status="block"
											 				 target="_blank">
								 				 			</h:commandLink>
								 				 		</h:column>
										       </rich:dataTable>
										     </h:panelGrid>
									       </ui:repeat>
								    </rich:modalPanel>
									
									
									<rich:spacer></rich:spacer>
									<rich:spacer></rich:spacer>
									 <h:outputLink value="#" id="comment" rendered="#{userExecution.comment.length() > 0}">
									        Comentário 
									        <rich:componentControl for="commentModal" attachTo="comment" operation="show" event="onclick"/>
									 </h:outputLink>
									 <rich:modalPanel id="commentModal" width="500">
								        <f:facet name="header">
								            <h:panelGroup>
								                <h:outputText value="Comentário"></h:outputText>
								            </h:panelGroup>
								        </f:facet>
								        <f:facet name="controls">
								            <h:panelGroup>
								                <h:graphicImage value="/img/close.png" styleClass="hidelink" id="hidelink"/>
								                <rich:componentControl for="commentModal" attachTo="hidelink" operation="hide" event="onclick"/>
								            </h:panelGroup>
								        </f:facet>
								        <h:outputText value="#{userExecution.comment}" />
								    </rich:modalPanel>
								</h:panelGrid>
							</rich:panel>
						</ui:repeat>
					</rich:simpleTogglePanel>
				</ui:repeat>
			</rich:simpleTogglePanel>
		</ui:repeat>
	</ui:define>
</ui:composition>
