<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:t="http://myfaces.apache.org/tomahawk">

	<h:panelGrid columns="1">
		<rich:tree id="tree" switchType="client" ajaxSubmitSelection="true" ajaxKeys="#{null}"
        	value="#{action.rootNode}" var="item" treeNodeVar="node" nodeFace="#{action.getType(item)}" >
        	<rich:treeNode  type="attr" icon="/img/attr.png" iconLeaf="/img/attr.png" >
        		
        		<h:panelGrid columns="2" >
	        		<h:outputText value="#{action.getName(item)}: " />
	        		
	        		<h:panelGroup>
	        		
		        		<h:panelGroup rendered="#{action.editNode == null or !action.editNode.data.equals(item)}" >
			        		<h:outputText value="#{action.getValueFromParent(node)}"/>
			        		<a4j:commandLink action="#{action.updateEditProperty(node)}" immediate="true" reRender="tree">
			                    <h:graphicImage value="/img/edit.jpg" styleClass="pic"/>
			                    <h:outputText value="Edit"/>
			        		</a4j:commandLink>
		        		</h:panelGroup>
		        		
		        		<h:panelGroup rendered="#{action.editNode.data.equals(item) and item.getEType().getInstanceTypeName() == 'java.lang.String'}" id="stringAttr" >
			        		<h:inputText value="#{action.textProperty}" /><br />
			        		<a4j:commandLink action="#{action.updateEditProperty()}" reRender="tree">
			                    <h:graphicImage value="/img/true.png" styleClass="pic"/>
			                    <h:outputText value="Save"/>
			        		</a4j:commandLink>
		        		</h:panelGroup>
		        		
		        		
		        		<h:panelGroup rendered="#{action.editNode.data.equals(item) and item.getEType().getInstanceTypeName() == 'int'}" id="intAttr" >
			        		<rich:inputNumberSpinner value="#{action.intProperty}" />
			        		<a4j:commandLink action="#{action.updateEditProperty()}" reRender="tree">
			                    <h:graphicImage value="/img/true.png" styleClass="pic"/>
			                    <h:outputText value="Save"/>
			        		</a4j:commandLink>
		        		</h:panelGroup>
	        		</h:panelGroup>
        		</h:panelGrid>
        		
        	</rich:treeNode>
            <rich:treeNode  type="ref" icon="/img/model.jpeg" iconLeaf="/img/model.jpeg">
            	<h:panelGrid columns="2" border="0">
            	    <h:outputText value="#{action.getName(item)}" />            	    
		            <rich:dropDownMenu rendered="#{item != null and action.dslUtil.getRefs(item).size > 0}">
		                <f:facet name="label"> 
		                    <h:panelGroup>
		                        <h:graphicImage value="/img/edit.jpg" styleClass="pic"/>
		                        <h:outputText value="Options"/>
		                    </h:panelGroup>
		                </f:facet>
		                <rich:menuItem  submitMode="none" disabled="true">
		                	<h:panelGroup>
			                	<ui:repeat value="#{action.dslUtil.getRefs(item)}" var="ref">
			                		<ui:repeat value="#{action.dslUtil.findClasses(ref)}" var="eclass">
			                			<a4j:commandButton value="New #{eclass.name}"
			                			 action="#{action.buildRef(item, ref, eclass)}" reRender="tree" />
			                			 <br />
			                		</ui:repeat>
				                </ui:repeat>
		                	</h:panelGroup>
			            </rich:menuItem>
			                
			            <rich:menuSeparator />
		            </rich:dropDownMenu>
		    	</h:panelGrid>
	    	</rich:treeNode>
	    	
        </rich:tree>
	</h:panelGrid>

</ui:composition>
