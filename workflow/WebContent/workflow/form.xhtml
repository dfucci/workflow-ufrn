<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:t="http://myfaces.apache.org/tomahawk">

	<h:panelGrid columns="1" width="100%">
		<rich:tree id="tree" switchType="client" value="#{action.rootNode}" var="item"
			treeNodeVar="node" nodeFace="#{action.getItemType(item)}">
			<rich:treeNode type="attr" icon="/img/attr.png"
				iconLeaf="/img/attr.png">

				<h:panelGrid columns="2">
					<a4j:support ignoreDupResponses="true" eventsQueue="tq" rendered="#{node != null and (action.editNode == null or !action.editNode.data.equals(item))}"
						action="#{action.updateEditProperty(node)}" reRender="tree" event="onclick" />
						
					<h:panelGroup class="attrNodeTitleContent">
						<h:outputText value="#{action.getName(item)}: "
							styleClass="attrNodeTitle" />
					</h:panelGroup>

					<h:panelGroup class="attrNodeTitleField" id="attrNodeTitleField">
				        
						<h:panelGroup
							rendered="#{node != null and (action.editNode == null or !action.editNode.data.equals(item))}">
							<h:outputText value="#{action.getValueFromParent(node)}"
								styleClass="attrNodeContent">
							</h:outputText>
						</h:panelGroup>

		
						<h:panelGroup rendered="#{action.editNode.data.equals(item)}">

							<h:panelGroup rendered="#{action.getFieldType(node) == 'refAttrMany'}">
								<h:selectOneMenu value="#{action.refAttrProperty}" id="refAttrMany">
									<s:selectItems value="#{action.getFieldValues(item)}"
										var="o" label="#{action.getName(o)}" />
								</h:selectOneMenu>
							</h:panelGroup>
							
							
							
							<h:panelGroup rendered="#{action.getFieldType(node) == 'string'}">
								<h:inputTextarea value="#{action.textProperty}" id="stringAttr" />
							</h:panelGroup>
							<h:panelGroup rendered="#{action.getFieldType(node) == 'int'}">
								<h:inputText value="#{action.intProperty}"
									id="intAttr" />
							</h:panelGroup>
							<h:panelGroup rendered="#{action.getFieldType(node) == 'enum'}">
								<h:selectOneMenu value="#{action.enumProperty}" id="enumAttr">
									<s:selectItems value="#{action.enumProperty.values()}"
										var="enum" label="#{enum.literal}" />
									<s:convertEnum />
								</h:selectOneMenu>
							</h:panelGroup>


							<a4j:commandLink ignoreDupResponses="true" eventsQueue="tq" action="#{action.updateEditProperty()}"
								reRender="tree">
								<h:graphicImage value="/img/true.png" styleClass="pic" />
								<h:outputText value="Save" />
							</a4j:commandLink>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGrid>

			</rich:treeNode>
			<rich:treeNode type="ref" icon="/img/model.jpeg"
				iconLeaf="/img/model.jpeg">
				<h:outputText value="#{action.getName(item)}"
					styleClass="refNodeTitle" />
				<h:panelGroup rendered="#{item != null and action.dslUtil.getRefs(item).size() > 0}">
					<rich:separator></rich:separator>
					<ui:repeat value="#{action.dslUtil.getRefs(item)}" var="ref">
						<ui:repeat value="#{action.dslUtil.findClasses(ref)}" var="eclass">
							<a4j:commandLink styleClass="refButton" ignoreDupResponses="true" eventsQueue="tq"
								value="New #{action.getName(eclass.name)}"
								action="#{action.buildRef(item, ref, eclass)}" reRender="tree" />
						</ui:repeat>
					</ui:repeat>
					<br />
					<br />
					<br />
				</h:panelGroup>
			</rich:treeNode>

		</rich:tree>
	</h:panelGrid>

</ui:composition>
