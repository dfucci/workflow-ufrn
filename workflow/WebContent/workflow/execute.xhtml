<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template.xhtml">
	<ui:define name="body">
		<rich:simpleTogglePanel switchType="client" label="#{executer.currentProcess.workflow.title}" opened="false" >
			<h:outputText value="#{executer.currentProcess.workflow.description}" />
		</rich:simpleTogglePanel>
		<br />
		<rich:panel header="#{executer.currentTaskNode.name}" rendered="#{executer.currentTaskNode != null}">
			<h:outputText value="#{executer.currentTaskNode.description}" />
			<rich:dataList value="#{executer.currentTaskNode.inArtefacts}" var="artefact" rendered="#{executer.currentTaskNode.inArtefacts.size() gt 0}">
				<h:outputText value="#{artefact.name}" /> - <h:commandLink action="#" value="Download" />
			</rich:dataList>
			<br /><br />
			
			<h:panelGroup rendered="#{executer.currentUserExecution != null}">
				<h:panelGrid columns="2">
					<h:outputLabel value="Enviar Artefatos:" rendered="#{executer.currentTaskNode.outArtefacts.size() gt 0}"/>
					<rich:dataTable value="#{executer.currentTaskNode.outArtefacts}" var="artefact" rendered="#{executer.currentTaskNode.outArtefacts.size() gt 0}">
						<h:column>
							<f:facet name="header">Nome</f:facet>
							<h:outputText value="#{artefact.name}" />
						</h:column>
						<h:column>
							<f:facet name="header"></f:facet>
							<h:commandLink action="#" value="Enviar" />
						</h:column>
					</rich:dataTable>
					
					<h:outputLabel value="Comentário:" for="userExecutionComment"/>
					<h:inputTextarea id="userExecutionComment" value="#{executer.currentUserExecution.comment}"
					 disabled="#{executer.currentUserExecution.finishedAt != null}"
					 rendered="#{executer.currentUserExecution != null}" />
				</h:panelGrid>
				<ui:repeat var="task" value="#{executer.currentTaskNode.tasks}">
					<br />
					<rich:simpleTogglePanel switchType="client" label="#{task.name}" opened="true">
						<h:outputText value="#{task.description}" />
						<rich:dataList value="#{task.inArtefacts}" var="artefact" rendered="#{task.inArtefacts.size() gt 0}">
							<h:outputText value="#{artefact.name}" /> - <h:commandLink action="#" value="Download" />
						</rich:dataList>
						<br /><br />
						<h:outputLabel value="Enviar Artefatos:" rendered="#{task.outArtefacts.size() gt 0}"/>
						<rich:dataTable value="#{task.outArtefacts}" var="artefact" rendered="#{task.outArtefacts.size() gt 0}">
							<h:column>
								<f:facet name="header">Nome</f:facet>
								<h:outputText value="#{artefact.name}" />
							</h:column>
							<h:column>
								<f:facet name="header"></f:facet>
								<h:commandLink action="#" value="Enviar" />
							</h:column>
						</rich:dataTable>
					</rich:simpleTogglePanel>
				</ui:repeat>
			</h:panelGroup>
		</rich:panel>
		
		<rich:panel header="#{executer.currentJoin.name}" rendered="#{executer.currentJoin != null}">
			<h:outputText value="#{executer.currentJoin.description}" />
		</rich:panel>
		
		<rich:panel header="#{executer.endState.name}" rendered="#{executer.endState != null}">
			<h:outputText value="#{executer.endState.description}" />
		</rich:panel>
		
		<h:panelGroup>
			<ui:repeat var="transition" value="#{executer.transitions}">
				<h:commandButton action="#{executer.next(transition)}" value="#{((executer.currentUserExecution.finishedAt == null or executer.currentTaskNode == null) ? transition.name : 'Pular tarefa já executada')}"
								 onclick="#{((executer.currentUserExecution.finishedAt == null and executer.currentTaskNode != null) ? 'javascript:return confirm(\'Você tem certeza?\')' : '')}"
								 styleClass="executeButton"/>
			</ui:repeat>
			<h:commandButton action="#{executer.next(null)}" value="#{((executer.currentUserExecution.finishedAt == null or executer.currentTaskNode == null) ? 'Finalizar' : 'Pular tarefa já executada')}"
							 styleClass="executeButton"
							 rendered="#{executer.currentTaskNode != null and executer.transitions.size eq 0}"	 
							 />
		</h:panelGroup>
	</ui:define>
</ui:composition>
