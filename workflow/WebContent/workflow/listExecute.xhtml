<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="/layout/list.xhtml">
	<ui:param name="action" value="#{executer}" />
	<ui:param name="defautlActions" value="#{false}" />
	
    <ui:define name="columns">
		<rich:column>
		 	<f:facet name="header">
            	<h:outputText value="#{messages['layout.text.workflow.experiments']}"/>
            </f:facet>
			<h:outputText value="#{entity.processDefinition.workflow.title}" />
		</rich:column>   
		<rich:column>
		 	<f:facet name="header">
            	<h:outputText value="#{messages['layout.text.workflow.treatment']}"/>
            </f:facet>
			<h:outputText value="#{entity.processDefinition.name}" />
		</rich:column>    	
    </ui:define>
    
    <ui:define name="actions"> 
    	<h:panelGroup rendered="#{entity.processDefinition.canExecute(entity)}">
			<ui:repeat var="q" value="#{entity.processDefinition.workflow.preQuestionnaires}">
					<a4j:commandButton reRender="questionnaireForm" action="#{executer.setCurrentQuestionnaire(q)}"
					 value="Questionnaire: #{q.name}" onclick="#{rich:component('panelQuestionnaire')}.show()">
					 	<ui:param name="disabledFieldsParam" value="#{q.isFinished(user)}" />
				    </a4j:commandButton>
			</ui:repeat>
			<br />
			<h:commandLink action="#{executer.init(entity.processDefinition, entity)}" title="play" >
    			<h:graphicImage value="/img/play.png" />
    		</h:commandLink>
    		<br />
    		<ui:repeat var="q" value="#{entity.processDefinition.workflow.postQuestionnaires}">
					<a4j:commandButton reRender="questionnaireForm" action="#{executer.setCurrentQuestionnaire(q)}"
					 value="Questionnaire: #{q.name}" onclick="#{rich:component('panelQuestionnaire')}.show()">
					 	<ui:param name="disabledFieldsParam" value="#{q.isFinished(user)}" />
				    </a4j:commandButton>
			</ui:repeat>
		</h:panelGroup>
    	<h:commandLink action="#" title="play" rendered="#{not entity.processDefinition.canExecute(entity)}">
    		<h:graphicImage value="/img/noplay.png" />
    	</h:commandLink>
    </ui:define>
    <ui:define name="modal">
	    <rich:modalPanel id="panelQuestionnaire" autosized="true" >
	        <f:facet name="header">
	            <h:panelGroup>
	                <h:outputText value="#{messages['layout.text.questionnaire']}"></h:outputText>
	            </h:panelGroup>
	        </f:facet>
	        <f:facet name="controls">
	            <h:panelGroup>
	                <h:graphicImage value="/img/close.png" styleClass="hidelink" id="hidelinkpanelQuestionnaire"/>
	                <rich:componentControl for="panelQuestionnaire" attachTo="hidelinkpanelQuestionnaire" operation="hide" event="onclick"/>
	            </h:panelGroup>
	        </f:facet>
	        <h:panelGroup id="questionnaireForm" style="height:400px; width: 600px; overflow:auto; display: block;">
		        <h:form enctype="multipart/form-data">
		        		<h3><h:outputText value="Questionnaire: #{executer.currentQuestionnaire.name}" /></h3>
		        		<ui:include src="questionnaireFields.xhtml" >
		        			<ui:param name="questions" value="#{executer.currentQuestionnaire.questions}" />
		        			<ui:param name="disabledFields" value="#{disabledFieldsParam}" />
		        			<ui:param name="metric" value="#{null}" />
			        		<ui:param name="taskNode" value="#{null}" />
		        		</ui:include>
		        		<a4j:commandButton value="Save" action="#{executer.saveQuestionnaire}" id="saveQuestionnaire" onclick="confirm( '#{messages['layout.messages.areYouSureCannotUndone?']}' )"/>
		        		<rich:componentControl for="panelQuestionnaire" attachTo="saveQuestionnaire" operation="hide" event="onclick"/>
			    </h:form>
	        </h:panelGroup>
	    </rich:modalPanel>
	</ui:define>
</ui:composition>
